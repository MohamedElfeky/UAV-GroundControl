<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>HXXT</title>
    <style>
        #map_canvas
        {
            background-color: #CCC;
            width: 100%;
            height: 100%;
            position: absolute;
            bottom: 0px;
            left: 0;
            right: 0;
            top: 0;
            margin: 0;
            padding: 0;
        }
    </style>
    <!--<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> -->
    <!--<script type="text/javascript" src="http://www.google.com/jsapi"></script> 
<script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3&sensor=false"></script>-->
    <script type="text/javascript" src="mapapi.js"></script>
    <script type="text/javascript">
        var map; //地图
        var marker;//无人机图标
        var flightPath;//航线
        var homePosition = new google.maps.LatLng(34.70916, 113.74729); //home点当前位置
        var UAVPosition = new google.maps.LatLng(34.70916, 113.74729); //无人机当前位置
        function CoordMapType() {
        }
        CoordMapType.prototype.tileSize = new google.maps.Size(256, 256);
        CoordMapType.prototype.maxZoom = 19;
        CoordMapType.prototype.minZoom = 3;

        CoordMapType.prototype.getTile = function (coord, zoom, ownerDocument) {
            var div = ownerDocument.createElement('div');
            div.innerHTML = '<img name="" src="./googlemapoverlay/' + zoom + '/' + coord.x + '/' + coord.y + '.png"/>';

            return div;
        };
        

        CoordMapType.prototype.name = "Tile #s";
        CoordMapType.prototype.alt = "Tile Coordinate Map Type";
         
				var myIcon = ("image/six_uav.png");
        var coordinateMapType = new CoordMapType();    //卫星图层
        
function HomeControl(controlDiv, map) {  
  
  // Set CSS styles for the DIV containing the control  
  // Setting padding to 5 px will offset the control  
  // from the edge of the map.  
  controlDiv.style.padding = '5px';  
  
  // Set CSS for the control border.  
  var controlUI = document.createElement('div');  
  controlUI.style.backgroundColor = 'white';  
  controlUI.style.borderStyle = 'solid';  
  controlUI.style.borderWidth = '2px';  
  controlUI.style.cursor = 'pointer';  
  controlUI.style.textAlign = 'center';  
  controlUI.title = 'Click to set the map to Home';  
  controlDiv.appendChild(controlUI);  
  
  // Set CSS for the control interior.  
  var controlText = document.createElement('div');  
  controlText.style.fontFamily = 'Arial,sans-serif';  
  controlText.style.fontSize = '12px';  
  controlText.style.paddingLeft = '4px';  
  controlText.style.paddingRight = '4px';  
  controlText.innerHTML = '<strong>Home</strong>';  
  controlUI.appendChild(controlText);  
  
  // Setup the click event listeners: simply set the map to Chicago.  
  google.maps.event.addDomListener(controlUI, 'click', function() {  
    map.setCenter(homePosition);  //设置家点
  });  
} 

function FindUAVControl(controlDiv2, map) {  
  
  // Set CSS styles for the DIV containing the control  
  // Setting padding to 5 px will offset the control  
  // from the edge of the map.  
  controlDiv2.style.padding = '5px';  
  
  // Set CSS for the control border.  
  var controlUI2 = document.createElement('div');  
  controlUI2.style.backgroundColor = 'white';  
  controlUI2.style.borderStyle = 'solid';  
  controlUI2.style.borderWidth = '2px';  
  controlUI2.style.cursor = 'pointer';  
  controlUI2.style.textAlign = 'center';  
  controlUI2.title = 'Click to set the map to Home';  
  controlDiv2.appendChild(controlUI2);  
  
  // Set CSS for the control interior.  
  var controlText2 = document.createElement('div');  
  controlText2.style.fontFamily = 'Arial,sans-serif';  
  controlText2.style.fontSize = '12px';  
  controlText2.style.paddingLeft = '4px';  
  controlText2.style.paddingRight = '4px';  
  controlText2.innerHTML = '<strong>UAV</strong>';  
  controlUI2.appendChild(controlText2);  
  
  // Setup the click event listeners: simply set the map to Chicago.  
  google.maps.event.addDomListener(controlUI2, 'click', function() {  
    map.setCenter(UAVPosition);
  });  
} 


function SetUAVMakerPosition(longitude,latitude)
{
   var newMakerPosition = new google.maps.LatLng(latitude,longitude);
  	
   UAVPosition=newMakerPosition;
   marker.setPosition(UAVPosition);
	var path = flightPath.getPath();
	path.push(new google.maps.LatLng(UAVPosition.lat(), UAVPosition.lng()));
	flightPath.setPath(path);
   
} 


function initialize() {
            var mapOptions = {
            	  zoom: 6,
                center: homePosition,
                minZoom: 1,
                maxZoom:14,
                mapTypeId: "coordinate",
                draggable:  true,
                keyboardShortcuts:   true,
                overviewMapControl: true,
                panControl:true,
                scrollwheel:true,
                zoomControl:true,
                disableDefaultUI:true,
            };
            map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
	
            map.mapTypes.set('coordinate', coordinateMapType);
            map.setOptions({ draggable: true , disableDoubleClickZoom: false  });
           //alert(navigator.userAgent)//弹出浏览器的user agent
           marker = new google.maps.Marker({  
     position: map.getCenter(),  
     icon:myIcon,
     draggable: true,
     map: map,  
     }); 
     
          
  var homeControlDiv = document.createElement('div'); 
  var homeControl = new HomeControl(homeControlDiv, map);  
  	
  var UAVControlDiv = document.createElement('div'); 
  var UAVControl = new FindUAVControl(UAVControlDiv, map);  
  
  homeControlDiv.index = 1;
	UAVControlDiv.index = 1 ;  

  map.controls[google.maps.ControlPosition.TOP_RIGHT].push(homeControlDiv);  
	map.controls[google.maps.ControlPosition.TOP_RIGHT].push(UAVControlDiv);  
  google.maps.event.addListener(map, 'center_changed', function() {  
    // 3 seconds after the center of the map has changed, pan back to the  
    // marker.  
//    window.setTimeout(function() {  
      //map.panTo(marker.getPosition());  
    //}, 3000);  
  });  
  
  
  //定义点
//var flightPlanCoordinates = [
//        new google.maps.LatLng(22.5800927480, 113.876207694),
//        new google.maps.LatLng(22.5900927480, 113.876207694),
//        new google.maps.LatLng(22.5900927480, 113.896207694),
//        new google.maps.LatLng(22.5800927480, 113.896207694)
//    ];
//定义线
        flightPath = new google.maps.Polyline({
            //path: flightPlanCoordinates,
            strokeColor: "#FF0000",
            strokeOpacity: 1.0,
            strokeWeight: 2
        });
//将线添加至地图
        flightPath.setMap(map);
  
  
  google.maps.event.addListener(map, 'move', function(event) {
  	 alert("Map You clicked the map."); 
   // map.setZoom(8);  
  //  map.setCenter(marker.getPosition());  
    ReinforcePC.getCoordinate(event.point.lng,event.point.lat);
  });
  
  google.maps.event.addListener(map, 'click', function(event) {
  	 var lat = event.latLng.lat; 
  	 var lon = event.latLng.lng;
  	 alert(lat());
  });   
  
google.maps.event.addListener(map, 'dragstart', function() {
//	alert("dragstart the map.");
});
 
google.maps.event.addListener(map, 'dragend', function(event) {
   
}); 


google.maps.event.addListener(map,'mousemove',function (MouseEvent){  
     //document.getElementById("showLatlng").innerHTML=event.latLng.lng()+','+event.latLng.lat();  
		ReinforcePC.getCoordinate(MouseEvent.latLng.lng(),MouseEvent.latLng.lat());
		//var myCenter2 = new google.maps.LatLng(34.70916, 118.74729); //郑州 
		//map.setCenter(myCenter2);
  });  
 
google.maps.event.addListener(marker, 'position_changed', function() {
	//alert("position_changed");
	
}); 
 
 google.maps.event.addListener(marker, 'dblclick', function(MouseEvent) {
 				
  			//alert(lat());
  			//alert("rightclick the maker.");
 				var newhomePosition = new google.maps.LatLng(MouseEvent.latLng.lat(),MouseEvent.latLng.lng());
 				homePosition = newhomePosition;
 				map.setCenter(homePosition);
   
});

 }
    </script>
</head>
<body onload="initialize()">
    <div>
    </div>
    <div id="map_canvas">
    </div>
</body>
</html>
